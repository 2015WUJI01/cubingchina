!function(t){function e(t){this._msgs=[],this._eventHandlers=[],this.threshold=2e4,this.lastActiveTime=Date.now(),this.uri=t,this.connect(),this.timer=setInterval(function(){this.conn.readyState!=WebSocket.CLOSING&&this.conn.readyState!=WebSocket.CLOSED||this.connect(),Date.now()-this.lastActiveTime>this.threshold&&this.send("ping")}.bind(this),1e3)}var n="WebSocket"in t;n&&(e.prototype={send:function(t){return this.conn.readyState!=WebSocket.OPEN?(this._msgs.push(t),this.connect()):(this.conn.send(JSON.stringify(t)),this.lastActiveTime=Date.now()),this},receive:function(t){this.lastActiveTime=Date.now();var e=t.data;try{var e=JSON.parse(e);if("pong"===e)return;200===e.code&&this.fire(e.type,e.data)}catch(t){}},connect:function(){var t=this;if(!(t.conn instanceof WebSocket&&t.conn.readyState==WebSocket.CONNECTING))try{var e=t.conn=new WebSocket(t.uri);e.onopen=function(){t.fire("connect"),t._msgs.forEach(function(t){e.send(JSON.stringify(t))}),t._msgs=[],t.lastActiveTime=Date.now(),e.onmessage=t.receive.bind(t)}}catch(n){}},on:function(t,e){return this._eventHandlers[t]=this._eventHandlers[t]||[],this._eventHandlers[t].push(e),this},off:function(t,e){if(this._eventHandlers[t]){if(void 0===e)return void(this._eventHandlers[t]=[]);var n=this._eventHandlers[t].indexOf(e);return n>-1&&this._eventHandlers[t].splice(n,1),this}},fire:function(t,e){var n=this;return n._eventHandlers["*"]&&n._eventHandlers["*"].forEach(function(t){t(e)}),n._eventHandlers[t]&&n._eventHandlers[t].forEach(function(t){t(e)}),n}},t.WS=e)}(this);