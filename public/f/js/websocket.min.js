!function(e){function t(e){this._msgs=[],this._eventHandlers=[],this.threshold=2e4,this.lastActiveTime=Date.now(),this.uri=e,this.connect(),this.timer=setInterval(function(){Date.now()-this.lastActiveTime>this.threshold&&this.send("ping")}.bind(this),1e3)}var n="WebSocket"in e;n&&(t.prototype={send:function(e){this.conn.readyState!=WebSocket.OPEN?(this._msgs.push(e),this.connect()):(this.conn.send(JSON.stringify(e)),this.lastActiveTime=Date.now())},receive:function(e){this.lastActiveTime=Date.now();var t=e.data;try{var t=JSON.parse(t);if("pong"===t)return;200===t.code&&this.fire(t.type,t.data)}catch(e){}},connect:function(){var e=this;if(!(e.conn instanceof WebSocket&&e.conn.readyState==WebSocket.CONNECTING))try{var t=e.conn=new WebSocket(e.uri);t.onopen=function(){e._msgs.forEach(function(e){t.send(JSON.stringify(e))}),e._msgs=[],e.lastActiveTime=Date.now(),t.onmessage=e.receive.bind(e)}}catch(n){}},on:function(e,t){this._eventHandlers[e]=this._eventHandlers[e]||[],this._eventHandlers[e].push(t)},off:function(e,t){if(this._eventHandlers[e]){if(void 0===t)return void(this._eventHandlers[e]=[]);var n=this._eventHandlers[e].indexOf(t);n>-1&&this._eventHandlers[e].splice(n,1)}},fire:function(e,t){var n=this;n._eventHandlers["*"]&&n._eventHandlers["*"].forEach(function(e){e.call(n,t)}),n._eventHandlers[e]&&n._eventHandlers[e].forEach(function(e){e.call(n,t)})}},e.WS=t)}(this);