!function(e){function t(){m.loading||(m.loading=!0,m.results=[],i.send({type:"result",action:"fetch",params:m.params}))}function n(e,t,n){return"DNF"===e?-1:"DNS"===e?-2:""===e?0:"333fm"===t?n?100*parseFloat(e):parseInt(e):void 0}function r(e,t){var n;if(e=parseInt(e),-1==e)return"DNF";if(-2==e)return"DNS";if(0==e)return"";if("333fm"===t)n=e>1e3?(e/100).toFixed(2):e;else if("333mbf"===t){var r=99-Math.floor(e/1e7),a=e%100;n=r+a+"/"+(r+2*a)+" "+s(Math.floor(e/100)%1e5,!0)}else{var o=e%100,u=Math.floor(e/100);10>o&&(o="0"+o),n=s(u)+"."+o}return n}function s(e,t){if(t&&99999==e)return"unknown";e=parseInt(e);var n=Math.floor(e/60),r=Math.floor(n/60);e%=60,n%=60;var s=[e];r>0?s.push(n,r):n>0&&s.push(n);for(var a=1;a<s.length;a++)s[a-1]<10&&(s[a-1]="0"+s[a-1]);return s.reverse().join(":")}function a(e,t){for(var n,r,s=0,a=e.length-1;a>=s;)n=s+a>>1,r=u(t,e[n],!0),0>r?a=n-1:s=n+1;return s}function o(e,t){for(var n=0,r=e.length;r>n;n++)!e[n-1]||u(e[n-1],e[n],!0)<0?e[n].pos=n+1:e[n].pos=e[n-1].pos,0==e[n].best&&(e[n].pos="-"),e[n].isNew=e[n]===t}function u(e,t,n){if(e.average>0&&t.average<=0)return-1;if(t.average>0&&e.average<=0)return 1;var r=e.average-t.average;if(0==r){if(e.best>0&&t.best<=0)return-1;if(t.best>0&&e.best<=0)return 1;r=e.best-t.best}return n||0!=r||(r=e.user.name<t.user.name?-1:1),r}if(!("WS"in e))return void alert("Your browser doesn't support, please upgrade!");var i=new WS("ws://"+location.host+"/ws");i.on("connect",function(){i.send({type:"competition",competitionId:m.competitionId}),t()}).on("newresult",function(e){l.dispatch("NEW_RESULT",e)}).on("newmessage",function(e){g(e)}).on("results",function(e){l.dispatch("UPDATE_RESULTS",e)}),Vue.use(VueRouter),Vue.use(Vuex);var c=$("#live-container"),m={user:{},competitionId:0,events:[],params:{event:"",round:""},loading:!1,results:[],messages:[]},f={},p={CHANGE_EVENT_ROUND:function(e,t){e.params=t},NEW_RESULT:function(e,t){if(t.competitionId==e.competitionId&&t.event==e.params.event&&t.round==e.params.round){t.pos="",t.isNew=!0;var n=e.results,r=a(n,t);n.splice(r,0,t),o(n,t)}},UPDATE_RESULT:function(e,t){if(t.competitionId==e.competitionId&&t.event==e.params.event&&t.round==e.params.round){var n=e.results,r=0,s=n.length;for(t.pos="",t.isNew=!0;s>r;r++)if(n[r].id==t.id){n[r]=t;break}n.sort(u),o(n,t)}},UPDATE_RESULTS:function(e,t){t.sort(u),o(t,{}),e.results=t,e.loading=!1},NEW_MESSAGE:function(e,t){e.messages.push(t),e.messages.length>1e3&&e.messages.splice(0,1)}};$.extend(m,c.data()),m.events.forEach(function(e){f[e.id]=e});var l=new Vuex.Store({state:m,mutations:p}),v=Vue.extend({template:"#live-container-template",store:l,components:{chat:{data:function(){return{message:""}},vuex:{getters:{messages:function(e){return e.messages}}},template:"#chat-template",methods:{send:function(e){var t=this;""!=t.message.trim()&&(i.send({type:"chat",content:t.message}),g({user:m.user,content:t.message,isSelf:!0},!0),t.message="")}},components:{message:{props:["message"],template:"#message-template",filters:{formatTime:function(e){return e?moment(new Date(1e3*e)).format("HH:mm:ss"):""}}}}},result:{data:function(){return{eventRound:null}},watch:{"$store.state.params":function(e){this.eventRound={event:e.event,round:e.round}}},vuex:{getters:{hasPermission:function(e){var t=e.user;return t.isOrganizer||t.isDelegate||t.isAdmin},eventName:function(e){return f[e.params.event]&&f[e.params.event].name},roundName:function(e){if(f[e.params.event])for(var t=f[e.params.event].rounds,n=0;n<t.length;n++)if(t[n].id==e.params.round)return t[n].name},loading:function(e){return e.loading},event:function(e){return e.params.event},round:function(e){return e.params.round},events:function(e){return e.events},results:function(e){return e.results}}},template:"#result-template",methods:{changeEventRound:function(){l.dispatch("CHANGE_EVENT_ROUND",{event:this.eventRound.event,round:this.eventRound.round})}},filters:{decodeResult:function(e,t){return r(e,t)}},components:{"input-panel":{data:function(){return{value1:0,value2:0,value3:0,value4:0,value5:0,best:0,worst:0,average:0,result:{id:null,event:"",name:"",number:0}}},filters:{result:{get:function(e){return r(e,this.result.event)},set:function(e){return n(e,this.result.event)}}},template:"#input-panel-template"}}}}}),d=new VueRouter;d.map({"/:event/:round":{component:{}}}),l.watch(function(e){return e.params},function(e){d.go(["",e.event,e.round].join("/")),t()},{deep:!0,sync:!0}),d.afterEach(function(e){var t=e.to.params;t.event==m.params.event&&t.round==m.params.round||l.dispatch("CHANGE_EVENT_ROUND",t)}),d.redirect({"*":["",m.params.event,m.params.round].join("/")}),d.start(v,c.get(0));var g=function(){var e=$(".message-container"),t=e.find("ul");return function(n,r){l.dispatch("NEW_MESSAGE",n),(r||e.height()+e.scrollTop()>t.height())&&Vue.nextTick(function(){e.scrollTop(t.height())})}}()}(this);