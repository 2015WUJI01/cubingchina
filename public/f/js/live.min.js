!function(e){function t(e,t){for(var n,r,a=0,o=e.length-1;o>=a;)n=a+o>>1,r=s(t,e[n]),0>r?o=n-1:a=n+1;return a}function s(e,t){if(e.average>0&&t.average<=0)return-1;if(t.average>0&&e.average<=0)return 1;var s=e.average-t.average;if(0==s){if(e.best>0&&t.best<=0)return-1;if(t.best>0&&e.best<=0)return 1;s=e.best-t.best}return s}if(!("WS"in e))return void alert("Your browser doesn't support, please upgrade!");Vue.use(VueRouter),Vue.use(Vuex);var n=$("#live-container"),r={competitionId:0,event:"",round:"",results:[],messages:[]},a={NEW_RESULT:function(e,n){n.pos="",n.isNew=!0;var r=e.results,a=t(r,n);r.splice(a,0,n);for(var o=0,u=r.length;u>o;o++)!r[o-1]||s(r[o-1],r[o])<0?r[o].pos=o+1:r[o].pos=r[o-1].pos,r[o].isNew=r[o]===n;e.results=r},NEW_MESSAGE:function(e,t){e.messages.push(t),e.messages.length>1e3&&e.messages.splice(0,1)}},o=new Vuex.Store({state:r,mutations:a}),u=new Vue({el:n.get(0),data:n.data(),template:$("#live-container-template").html(),store:o,components:{chat:Vue.extend({data:function(){return{message:""}},vuex:{getters:{messages:function(e){return e.messages}}},template:$("#chat-template").html(),methods:{send:function(e){var t=this;""!=t.message.trim()&&(i.send({type:"chat",text:t.message}),c({text:t.message},!0),t.message="")}}}),result:Vue.extend({vuex:{getters:{results:function(e){return e.results}}},template:$("#result-template").html()})}}),i=new WS("ws://"+location.host+"/ws");i.on("connect",function(){this.send({type:"competition",competitionId:u.competitionId})}).on("newresult",function(e){o.dispatch("NEW_RESULT",e)}).on("newmessage",function(e){c(e)});var c=function(){var e=$(".message-container"),t=e.find("ul");return function(s,n){o.dispatch("NEW_MESSAGE",s),(n||e.height()+e.scrollTop()>t.height())&&u.$nextTick(function(){e.scrollTop(t.height())})}}()}(this);