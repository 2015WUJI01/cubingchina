!function(e){function t(e,t){if(t){if(99999==e)return"unknown";if(3600==e)return"60:00"}e=parseInt(e);var n=Math.floor(e/60),r=Math.floor(n/60);e%=60,n%=60;var s=[e];return r>0?s.push(n,r):n>0&&s.push(n),s.reverse().join(":")}function n(e,t){for(var n,r,o=0,i=e.length-1;i>=o;)n=o+i>>1,r=s(t,e[n]),0>r?i=n-1:o=n+1;return o}function r(e,t){for(var n=0,r=e.length;r>n;n++)!e[n-1]||s(e[n-1],e[n])<0?e[n].pos=n+1:e[n].pos=e[n-1].pos,0==e[n].best&&(e[n].pos="-"),e[n].isNew=e[n]===t}function s(e,t){if(e.average>0&&t.average<=0)return-1;if(t.average>0&&e.average<=0)return 1;var n=e.average-t.average;if(0==n){if(e.best>0&&t.best<=0)return-1;if(t.best>0&&e.best<=0)return 1;n=e.best-t.best}return n}if(!("WS"in e))return void alert("Your browser doesn't support, please upgrade!");Vue.use(VueRouter),Vue.use(Vuex);var o=$("#live-container"),i={competitionId:0,events:{},event:"",round:"",results:[],messages:[]},u={CHANGE_EVENT:function(e,t){void 0!==e.events[t]&&(e.event=t,e.results=[],c.send({type:"result",command:"event",event:t}))},CHANGE_ROUND:function(e,t){e.events[e.event].indexOf(t)>-1&&(e.round=t,e.results=[],c.send({type:"result",command:"round",round:t}))},NEW_RESULT:function(e,t){if(t.competitionId==e.competitionId&&t.event==e.event&&t.round==e.round){t.pos="",t.isNew=!0;var s=e.results,o=n(s,t);s.splice(o,0,t),r(s,t)}},UPDATE_RESULT:function(e,t){if(t.competitionId==e.competitionId&&t.event==e.event&&t.round==e.round){var n=e.results,o=0,i=n.length;for(t.pos="",t.isNew=!0;i>o;o++)if(n[o].id==t.id){n[o]=t;break}n.sort(s),r(n,t)}},NEW_MESSAGE:function(e,t){e.messages.push(t),e.messages.length>1e3&&e.messages.splice(0,1)}};$.extend(i,o.data());var a=new Vuex.Store({state:i,mutations:u}),f=new Vue({el:o.get(0),template:$("#live-container-template").html(),store:a,components:{chat:Vue.extend({data:function(){return{message:""}},vuex:{getters:{messages:function(e){return e.messages}}},template:$("#chat-template").html(),methods:{send:function(e){var t=this;""!=t.message.trim()&&(c.send({type:"chat",text:t.message}),l({text:t.message},!0),t.message="")}}}),result:Vue.extend({vuex:{getters:{results:function(e){return e.results}}},template:$("#result-template").html(),filters:{formatTime:function(e,n){var r;if(e=parseInt(e),-1==e)return"DNF";if(-2==e)return"DNS";if(0==e)return"";if("333fm"===n)r=e>1e3?(e/100).toFixed(2):e;else if("333mbf"===n){var s=99-Math.floor(e/1e7),o=e%100;r=s+o+"/"+(s+2*o)+" "+t(Math.floor(e/100)%1e5,!0)}else{var i=e%100,u=Math.floor(e/100);r=t(u)+"."+i}return r}}})}}),c=new WS("ws://"+location.host+"/ws");c.on("connect",function(){c.send({type:"competition",competitionId:a.competitionId})}).on("newresult",function(e){a.dispatch("NEW_RESULT",e)}).on("newmessage",function(e){l(e)});var l=function(){var e=$(".message-container"),t=e.find("ul");return function(n,r){a.dispatch("NEW_MESSAGE",n),(r||e.height()+e.scrollTop()>t.height())&&f.$nextTick(function(){e.scrollTop(t.height())})}}()}(this);